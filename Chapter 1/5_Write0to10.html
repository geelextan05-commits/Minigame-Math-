<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Path Draw (Write 0 to 10)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .game-container {
            max-width: 600px;
            min-height: 400px;
            background-color: #e0f2fe;
            border: 5px solid #0284c7;
            position: relative;
        }
        .platform {
            width: 80px;
            height: 40px;
            line-height: 40px;
            background-color: #fcd34d;
            border: 3px solid #b45309;
            color: #b45309;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            border-radius: 8px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }
        .gap {
            width: 80px;
            height: 40px;
            line-height: 40px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            border-radius: 8px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            border: 2px dashed #38bdf8;
            color: #0284c7;
            background-color: #bae6fd;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .bridge {
            width: 80px;
            height: 40px;
            background-color: #22c55e;
            color: white;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            border-radius: 8px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: build 0.5s ease-out;
        }
        @keyframes build {
            0% { transform: translateY(-50%) scale(0); opacity: 0; }
            100% { transform: translateY(-50%) scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-xl text-center">
        <h1 class="text-3xl font-extrabold text-sky-700 mb-4">ðŸŒ‰ Path Draw: Numbers 0 to 10</h1>
        <p class="text-gray-600 mb-2">Type the correct number to complete the sequence!</p>

        <div class="text-xl mb-4">
            Score: <span id="score">0</span> / 5 |
            Misses: <span id="misses">0</span> / 5
        </div>

        <div id="game-container" class="game-container mx-auto rounded-xl shadow-lg relative p-4">
            <div id="platform-left" class="platform" style="left: 20px;"></div>
            <div id="gap-center" class="gap" style="left: 50%; margin-left: -40px;">?</div>
            <div id="platform-right" class="platform" style="right: 20px;"></div>
        </div>

        <div class="mt-8 flex justify-center items-center space-x-4">
            <input type="number" id="answer-input" class="w-24 p-3 border-4 border-lime-500 rounded-lg text-xl text-center focus:outline-none" placeholder="?" min="0" max="10">
            <button id="submit-button" class="px-6 py-3 bg-lime-500 text-white font-bold rounded-lg shadow-md hover:bg-lime-600">Build Path</button>
        </div>

        <div id="feedback-box" class="mt-4 h-8 text-xl font-bold text-gray-800"></div>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const platformLeft = document.getElementById('platform-left');
        const platformRight = document.getElementById('platform-right');
        const gapCenter = document.getElementById('gap-center');
        const answerInput = document.getElementById('answer-input');
        const submitButton = document.getElementById('submit-button');
        const feedbackBox = document.getElementById('feedback-box');

        const scoreEl = document.getElementById('score');
        const missesEl = document.getElementById('misses');

        let score = 0;
        let misses = 0;
        const MAX_SCORE = 5;
        const MAX_MISSES = 5;

        let currentSequence = [];
        let missingNumber = 0;
        let bridgeElement = null;
        let gameActive = true;

        const generateSequence = () => {
            if (!gameActive) return;

            let start = Math.floor(Math.random() * 8);
            let numbers = [start, start + 1, start + 2, start + 3];

            const missingIndex = Math.floor(Math.random() * 2) + 1;
            missingNumber = numbers[missingIndex];

            currentSequence = [
                numbers[missingIndex - 1],
                numbers[missingIndex + 1]
            ];

            platformLeft.textContent = currentSequence[0];
            platformRight.textContent = currentSequence[1];
            gapCenter.textContent = '?';

            if (bridgeElement) {
                bridgeElement.remove();
                bridgeElement = null;
            }

            gapCenter.style.display = 'flex';
            answerInput.value = '';
            feedbackBox.textContent = 'Type the missing number.';
        }

        const endGame = (success) => {
            gameActive = false;
            submitButton.disabled = true;
            answerInput.disabled = true;

            feedbackBox.textContent = success ? "ðŸŽ‰ Level Passed!" : "âŒ Level Failed!";
            feedbackBox.className = success
                ? "mt-4 h-8 text-xl font-bold text-green-600"
                : "mt-4 h-8 text-xl font-bold text-red-600";

            // Send result to parent loader
            window.parent.postMessage(
                { type: "levelResult", success: success },
                "*"
            );
        };

        const handleSubmission = () => {
            if (!gameActive) return;

            const answer = parseInt(answerInput.value);

            if (answer === missingNumber) {
                feedbackBox.textContent = `ðŸŽ‰ Correct!`;
                feedbackBox.className = "mt-4 h-8 text-xl font-bold text-green-600";

                score++;
                scoreEl.textContent = score;

                bridgeElement = document.createElement('div');
                bridgeElement.className = 'bridge';
                bridgeElement.textContent = missingNumber;
                bridgeElement.style.left = gapCenter.style.left;
                bridgeElement.style.marginLeft = gapCenter.style.marginLeft;
                gameContainer.appendChild(bridgeElement);
                gapCenter.style.display = 'none';

                if (score >= MAX_SCORE) {
                    endGame(true);
                    return;
                }

                setTimeout(generateSequence, 1200);

            } else {
                feedbackBox.textContent = `âŒ Wrong! Try again!`;
                feedbackBox.className = "mt-4 h-8 text-xl font-bold text-red-600";

                misses++;
                missesEl.textContent = misses;

                answerInput.value = "";

                if (misses >= MAX_MISSES) {
                    endGame(false);
                }
            }
        }

        submitButton.addEventListener('click', handleSubmission);
        answerInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleSubmission();
        });

        generateSequence();
    </script>
</body>
</html>
