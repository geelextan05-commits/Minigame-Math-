<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Level 7 â€“ Money Adventure</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f0fff4;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #008060;
            font-weight: 800;
            font-size: 38px;
            margin-bottom: 5px;
        }

        p {
            color: #333;
            font-weight: 600;
        }

        /* --- GAME LAYOUT GRID --- */
        #gameContainer {
            display: grid;
            grid-template-columns: 1fr 2fr;
            /* Item Box (Left) | Money Pool (Right) */
            gap: 20px;
            max-width: 900px;
            margin: 30px auto 0 auto;
        }

        /* Clarifying titles for the grid sections */
        .section-title {
            font-size: 18px;
            font-weight: 800;
            color: #008060;
            margin-bottom: 10px;
        }

        .left-panel {
            grid-column: 1 / 2;
        }

        .right-panel {
            grid-column: 2 / 3;
        }

        /* Item Box - Left Side (Target) */
        #itemBox {
            grid-row: 2 / 3;
            background: #008060;
            padding: 20px;
            border: 3px solid #ffde54;
            border-radius: 15px;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        #itemBox h2 {
            font-size: 28px;
            margin-top: 0;
            margin-bottom: 5px;
        }

        #itemBox p {
            font-size: 20px;
            font-weight: 700;
            color: #fffbe6;
        }

        #itemPrice {
            font-size: 32px;
            color: #ffde54;
        }

        /* Money Pool - Right Side (Source) */
        #moneyPool {
            grid-row: 2 / 3;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            padding: 20px 10px;
            background: #eafff2;
            border: 2px solid #66cc99;
            border-radius: 15px;
            box-shadow: inset 0 0 10px rgba(0, 128, 96, 0.2);
        }

        /* Money Image Base */
        .money-img {
            cursor: grab;
            border-radius: 8px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
            transition: transform 0.1s;
        }

        .money-img:hover {
            transform: scale(1.05);
        }

        .coin {
            width: 55px;
            height: 55px;
            object-fit: cover;
        }

        .note {
            width: 100px;
            height: 50px;
            object-fit: contain;
        }

        /* Payment Box (Drop Zone) */
        #paymentBox {
            margin: 30px auto 0 auto;
            max-width: 600px;
            background: linear-gradient(145deg, #ffffff, #f0f8ff);
            border: 4px dashed #0080ff;
            padding: 25px 20px;
            min-height: 120px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            border-radius: 20px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        #paymentBox p {
            font-size: 18px;
            font-style: italic;
            color: #0080ff;
            transition: opacity 0.3s;
            width: 100%;
            text-align: center;
        }

        /* Timer & Feedback */
        #timer {
            font-size: 28px;
            font-weight: 800;
            color: #e63946;
            margin-top: 20px;
        }

        #feedback {
            font-size: 26px;
            font-weight: 800;
            margin-top: 20px;
            height: 35px;
        }

        #scoreDisplay {
            font-size: 20px;
            font-weight: 700;
            color: #008060;
            margin-top: 10px;
        }

        /* --- CHECK PAYMENT BUTTON STYLE (Enhanced) --- */
        button.check-button {
            padding: 18px 40px;
            border-radius: 15px;
            border: none;
            background: linear-gradient(180deg, #ff8c00, #ff4500);
            color: white;
            font-size: 24px;
            font-weight: 800;
            margin-top: 30px;
            cursor: pointer;
            box-shadow: 0 6px 0 #cc3700;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button.check-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 0 #cc3700;
        }

        button.check-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #cc3700;
        }

        /* Continue Button Style */
        button#nextBtn {
            padding: 15px 30px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(180deg, #66cc99, #008060);
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin-top: 25px;
            cursor: pointer;
            box-shadow: 0 4px 0 #005c3b;
            transition: all 0.2s;
        }

        button#nextBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #005c3b;
        }

        button#nextBtn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #005c3b;
        }

        /* Media query for smaller screens */
        @media (max-width: 700px) {
            #gameContainer {
                grid-template-columns: 1fr;
            }

            .left-panel,
            .right-panel {
                grid-column: 1 / 2;
            }

            #itemBox,
            #moneyPool {
                min-width: 100%;
            }
        }
    </style>
</head>

<body>

    <h1>ðŸŽ¯ Level 7 â€“ Money Adventure</h1>
    <p>Drag the exact combination of money to the drop zone to pay for the item!</p>
    <div id="timer"></div>
    <div id="scoreDisplay">Score: 0/10</div>

    <div id="gameContainer">
        <div class="left-panel">
            <p class="section-title">ðŸ›’ ITEM TO BUY</p>
        </div>
        <div class="right-panel">
            <p class="section-title">ðŸ’¸ AVAILABLE MONEY</p>
        </div>
        Â  Â  <div id="itemBox">
            Â  Â  Â  Â  <h2 id="itemName">Item</h2>
            Â  Â  Â  Â  <p>Total Price: RM<span id="itemPrice">0</span></p>
            Â  Â  </div>
        Â  Â  <div id="moneyPool"></div>
    </div>

    <div id="paymentBox" ondragover="allowDrop(event)" ondrop="dropMoney(event)">
        Â  Â  <p id="dropPrompt">ðŸ’° Drop money here to make the payment</p>
    </div>
    <div id="feedback"></div>

    <button class="check-button" onclick="checkPayment()">CHECK PAYMENT</button>
    <button id="nextBtn" style="display:none;" onclick="nextQuestion()">Continue</button>


    <script>
        let moneyImages = [
            { name: '5sen', src: 'images/5sen.png', value: 0.05 },
            { name: '10sen', src: 'images/10sen.png', value: 0.10 },
            { name: '20sen', src: 'images/20sen.png', value: 0.20 },
            { name: '50sen', src: 'images/50sen.png', value: 0.50 },
            { name: 'RM1', src: 'images/RM1.png', value: 1 },
            { name: 'RM5', src: 'images/RM5.png', value: 5 },
            { name: 'RM10', src: 'images/RM10.png', value: 10 },
            { name: 'RM20', src: 'images/RM20.png', value: 20 },
            { name: 'RM50', src: 'images/RM50.png', value: 50 },
            { name: 'RM100', src: 'images/RM100.png', value: 100 }
        ];

        // --- UPDATED QUESTIONS ARRAY (10 Questions Total) ---
        let questions = [
            // Original 5 Questions
            { name: "Ice Cream ðŸ¦", price: 3.00, pool: ['RM1', 'RM1', 'RM1', '50sen'] },
            { name: "Toy Car ðŸš—", price: 12.00, pool: ['RM10', 'RM1', 'RM1', 'RM5'] },
            { name: "Story Book ðŸ“š", price: 15.00, pool: ['RM10', 'RM5', 'RM20'] },
            { name: "Kuih ðŸ¥Ÿ", price: 4.50, pool: ['RM1', 'RM1', 'RM1', 'RM1', '50sen', 'RM5'] },
            { name: "Sticker Pack ðŸ·ï¸", price: 7.00, pool: ['RM5', 'RM1', 'RM1', 'RM10'] },

            // NEW 5 Questions
            { name: "Chocolate Bar ðŸ«", price: 1.70, pool: ['RM1', '50sen', '20sen', '10sen', '5sen'] },
            { name: "Pencil Case âœï¸", price: 8.90, pool: ['RM5', 'RM1', 'RM1', 'RM1', '50sen', '20sen', '20sen', '5sen'] },
            { name: "Water Bottle ðŸ’§", price: 22.00, pool: ['RM20', 'RM5', 'RM1', 'RM1'] },
            { name: "Mini Pizza ðŸ•", price: 6.30, pool: ['RM5', 'RM1', '50sen', '20sen', '10sen'] },
            { name: "Small Toy ðŸ§¸", price: 3.85, pool: ['RM1', 'RM1', 'RM1', '50sen', '20sen', '10sen', '5sen'] }
        ];

        let current = 0, score = 0, totalTime = 20, timer;
        const TOTAL_QUESTIONS = questions.length;

        function startTimer() {
            document.getElementById('timer').innerText = `Time: ${totalTime}s`;
            timer = setInterval(() => {
                totalTime--;
                document.getElementById('timer').innerText = `Time: ${totalTime}s`;
                if (totalTime <= 0) { clearInterval(timer); checkPayment(true); }
            }, 1000);
        }

        function updateScore() {
            // Updated to use TOTAL_QUESTIONS constant
            document.getElementById('scoreDisplay').innerText = `Score: ${score}/${TOTAL_QUESTIONS}`;
        }

        function loadQuestion() {
            document.getElementById('paymentBox').innerHTML = '<p id="dropPrompt">ðŸ’° Drop money here to make the payment</p>';
            document.getElementById('feedback').innerText = '';
            document.getElementById('nextBtn').style.display = 'none';
            document.querySelector('.check-button').style.display = 'inline-block';
            totalTime = 20; startTimer();

            let q = questions[current];
            document.getElementById('itemName').innerText = q.name;
            document.getElementById('itemPrice').innerText = q.price.toFixed(2);

            let poolMoney = q.pool.map(name => moneyImages.find(m => m.name === name));

            let requiredNames = q.pool;
            // Add 2 distractors that are not *required* for the payment
            let distractors = moneyImages.filter(m => !requiredNames.includes(m.name))
                .sort(() => 0.5 - Math.random())
                .slice(0, 2);

            poolMoney.push(...distractors);

            poolMoney.sort(() => 0.5 - Math.random());

            let poolHTML = '';
            poolMoney.forEach((money, index) => {
                let cls = money.value < 1 ? 'coin' : 'note';
                poolHTML += `<img src="${money.src}" class="money-img ${cls}" draggable="true" data-value="${money.value}" id="money-${index}" ondragstart="dragMoney(event)">`;
            });
            document.getElementById('moneyPool').innerHTML = poolHTML;

            updateScore();
        }

        function dragMoney(ev) {
            ev.dataTransfer.setData("text/value", ev.target.dataset.value);
            ev.dataTransfer.setData("text/src", ev.target.src);
            ev.dataTransfer.setData("text/id", ev.target.id);
            ev.dataTransfer.setData("text/class", ev.target.className);
        }

        function allowDrop(ev) { ev.preventDefault(); }

        function dropMoney(ev) {
            ev.preventDefault();
            let value = parseFloat(ev.dataTransfer.getData("text/value"));
            let src = ev.dataTransfer.getData("text/src");
            let originalId = ev.dataTransfer.getData("text/id");
            let originalClass = ev.dataTransfer.getData("text/class");

            let prompt = document.getElementById('dropPrompt'); if (prompt) prompt.style.display = 'none';

            let img = document.createElement('img');
            img.src = src;
            let sizeClass = originalClass.split(' ').filter(c => c !== 'money-img').join(' ');
            img.className = 'money-img ' + sizeClass;
            img.dataset.value = value;

            img.onclick = function () {
                let currentClass = this.className;
                this.remove();
                let pool = document.getElementById('moneyPool');
                let originalImg = document.createElement('img');
                originalImg.src = src;
                originalImg.className = currentClass;
                originalImg.dataset.value = value;
                originalImg.draggable = true;
                originalImg.id = originalId;
                originalImg.ondragstart = dragMoney;
                pool.appendChild(originalImg);

                if (paymentBox.getElementsByTagName('img').length === 0) {
                    let prompt = document.getElementById('dropPrompt'); if (prompt) prompt.style.display = 'block';
                }
            };
            document.getElementById('paymentBox').appendChild(img);
            document.getElementById(originalId).remove();
        }

        function checkPayment(timeOut = false) {
            clearInterval(timer);
            let paymentBox = document.getElementById('paymentBox');
            let total = 0;
            Array.from(paymentBox.getElementsByTagName('img')).forEach(img => total += parseFloat(img.dataset.value));
            let roundedTotal = parseFloat(total.toFixed(2));
            let correctPrice = questions[current].price;

            Array.from(paymentBox.getElementsByTagName('img')).forEach(img => img.onclick = null);

            document.querySelector('.check-button').style.display = 'none';

            if (roundedTotal === correctPrice) {
                document.getElementById('feedback').style.color = '#008060';
                document.getElementById('feedback').innerHTML = `âœ… **Perfect!** You paid RM${roundedTotal.toFixed(2)} exactly.`;
                score++;
            } else if (timeOut) {
                document.getElementById('feedback').style.color = '#e63946';
                document.getElementById('feedback').innerHTML = `â° **Time's Up!** You paid RM${roundedTotal.toFixed(2)}. Target: RM${correctPrice.toFixed(2)}.`;
            } else {
                document.getElementById('feedback').style.color = '#e63946';
                document.getElementById('feedback').innerHTML = `âŒ **Incorrect!** You paid RM${roundedTotal.toFixed(2)}. Target: RM${correctPrice.toFixed(2)}.`;
            }

            updateScore();
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            current++;
            if (current >= TOTAL_QUESTIONS) {
                alert(`ðŸŽ‰ Level 7 Completed!\nFinal Score: ${score}/${TOTAL_QUESTIONS}. You finished Chapter 4!`);
                localStorage.setItem("C4_Level7", "completed");
                window.location.href = "C4.html";
            } else loadQuestion();
        }

        window.onload = loadQuestion;
    </script>

</body>

</html>