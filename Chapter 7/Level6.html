<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 7 - Level 6: Interactive Shape Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- 1. THEME & BACKGROUND --- */
        body {
            font-family: 'Fredoka', sans-serif;
            /* Bright, cheerful background */
            background: linear-gradient(135deg, #a2d2ff 0%, #ffc04b 100%); 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* --- 2. HEADER & TITLE STYLING --- */
        .level-title {
            font-size: clamp(2rem, 5vw, 4rem);
            font-weight: 900;
            color: #ff4757; /* Mr. Square's Red */
            text-shadow: 
                3px 3px 0px #2f3542, 
                5px 5px 0px #ffa502,
                0 0 10px rgba(0, 0, 0, 0.3);
            -webkit-text-stroke: 1px #2f3542; 
            letter-spacing: 2px;
            margin-bottom: 20px;
        }
        
        /* Main Container: The Adventure Board */
        .quiz-board {
            background-color: #f7f7f7;
            border: 8px solid #03a9f4; /* Blue border */
            box-shadow: 0 15px 0px 0px #0288d1, 0 20px 40px rgba(0,0,0,0.3);
            border-radius: 40px; 
        }

        /* --- 3. PROGRESS BAR (The Path) --- */
        #progress-bar-container {
            border: 3px solid #6c5ce7; /* Purple Outline */
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        #progress-bar {
            background-color: #6c5ce7; /* Vibrant Purple Progress */
            border-radius: 9999px;
        }

        /* --- 4. QUESTION CARD (The Riddle Scroll) --- */
        .question-card {
            background-color: #ffffff;
            border-radius: 20px; /* More rounded corners */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); /* Stronger shadow */
            padding: 30px;
            border-bottom: 6px solid #ff7f50; /* Orange base for lift effect */
        }
        .question-card h3 {
             font-size: 1.75rem;
             color: #6c5ce7; /* Purple for focus */
             text-shadow: 1px 1px 0 #fff;
        }
        .question-card p {
            font-size: 1.5rem;
            color: #2f3542;
        }


        /* --- 5. MCQ Button Styling (The Treasure Chests) --- */
        .mcq-option {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            
            /* Default Blue/Adventure Theme */
            background-color: #03a9f4; 
            color: white;
            border: 4px solid white;
            border-bottom: 6px solid #0288d1; 
            box-shadow: 0 6px 0px 0px #0288d1;
            transition: all 0.15s;
            border-radius: 15px; /* Slightly less rounded than card */
            padding: 15px;
            cursor: pointer;
        }

        .mcq-option:hover:not(:disabled) {
            transform: translateY(-2px);
            border-bottom-width: 8px;
            box-shadow: 0 8px 0px 0px #0288d1;
        }
        .mcq-option:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0px 0px #0288d1;
            border-bottom-width: 4px;
        }
        
        /* State Styles */
        .mcq-option.correct {
            background-color: #2ed573; /* Success Green */
            border-color: white;
            border-bottom-color: #218c74;
            box-shadow: 0 6px 0px 0px #218c74;
        }
        .mcq-option.incorrect {
            background-color: #ff4757; /* Error Red */
            border-color: white;
            border-bottom-color: #cc3744;
            box-shadow: 0 6px 0px 0px #cc3744;
        }

        /* --- 6. FEEDBACK BOX --- */
        #feedback-box {
            font-family: 'Fredoka', sans-serif;
            font-weight: 700;
            font-size: 1.125rem;
            margin-top: 20px;
            border-radius: 15px;
            padding: 15px;
        }

        .feedback-correct {
            background-color: #d8f5d8; /* Light green */
            color: #2e7d32; 
            border: 3px solid #4CAF50;
        }
        .feedback-incorrect {
            background-color: #fff0f0; /* Light red */
            color: #c62828; 
            border: 3px solid #f44336;
        }

        /* --- 7. NEXT BUTTON (The Travel Button) --- */
        #next-btn {
            font-family: 'Fredoka', sans-serif;
            font-weight: 900;
            border: 4px solid white;
            border-bottom: 6px solid;
            box-shadow: 0 6px 0px 0px;
        }
        #next-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            border-bottom-width: 8px;
        }
        #next-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0px 0px;
            border-bottom-width: 4px;
        }
        
        /* Disabled Style */
        #next-btn.bg-gray-400 {
            border-bottom-color: #9e9e9e;
            box-shadow: 0 6px 0px 0px #9e9e9e;
        }

        /* Enabled/Green Style (Success) */
        #next-btn.bg-green-600 {
            background-color: #2ed573;
            border-bottom-color: #218c74;
            box-shadow: 0 6px 0px 0px #218c74;
        }

        /* Finish Style (Pink/Final) */
        #next-btn.bg-pink-500 {
            background-color: #fd79a8;
            border-bottom-color: #d65a88;
            box-shadow: 0 6px 0px 0px #d65a88;
        }

        /* Animation Classes */
        /* Keep slide-in/slide-out animations for smooth transitions */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutLeft {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(-100%); opacity: 0; }
        }

        .animate-in {
            animation: slideInRight 0.5s forwards;
        }
        .animate-out {
            animation: slideOutLeft 0.5s forwards;
        }
        
        .question-card.animate-out {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <h1 class="level-title" id="main-title">Level 6 â€“ Super Shape Challenge! ðŸ§ </h1>

    <div class="quiz-board w-full max-w-4xl p-6 md:p-10 text-center">
        
        <p id="level-intro" class="text-xl text-gray-700 mb-6 font-semibold">
            Mr. Square needs your help! Solve 5 challenging shape riddles to complete your quest.
        </p>
        
        <div id="progress-bar-container" class="w-full h-4 rounded-full mb-8 overflow-hidden">
            <div id="progress-bar" class="h-full transition-all duration-500 ease-out" style="width: 0%;"></div>
        </div>

        <div id="question-card-container">
            </div>

        <div class="mt-8 flex justify-center space-x-4">    
        <button id="next-btn" onclick="nextQuestion()" disabled
            class="px-8 py-3 text-xl font-bold rounded-full transition duration-300 ease-in-out transform
                    bg-gray-400 text-white shadow-lg shadow-gray-400/50 cursor-not-allowed hover:scale-[1.02] active:scale-[0.98]">
            Continue
        </button>
        </div>

    </div>
    <script>
    // Data for the Multiple Choice Quiz (15 total questions)
    const questionBank = [
        {
            id: 1,
            question: "I have 4 straight sides, but only the opposite sides are the same length. What shape am I?",
            options: ["SQUARE", "RECTANGLE", "TRIANGLE"],
            correctIndex: 1, // RECTANGLE
            method: "A Rectangle has 4 sides and 4 corners, and its opposite sides are equal in length."
        },
        {
            id: 2,
            question: "Which of these shapes has exactly 3 corners?",
            options: ["SQUARE", "CIRCLE", "TRIANGLE"],
            correctIndex: 2, // TRIANGLE
            method: "The Triangle gets its name from having exactly 3 sides and 3 corners."
        },
        {
            id: 3,
            question: "Which shape can roll easily because it has NO straight sides?",
            options: ["STAR", "CIRCLE", "RECTANGLE"],
            correctIndex: 1, // CIRCLE
            method: "The Circle is a round shape with a curved line, so it can roll and has no straight sides."
        },
        {
            id: 4,
            question: "If you put a Square (4 sides) and a Circle (0 sides) together, what is the total number of sides?",
            options: ["4", "5", "8"],
            correctIndex: 0, // 4
            method: "Total sides is 4 (Square) + 0 (Circle) = 4 sides."
        },
        {
            id: 5,
            question: "What is the next shape in this repeating pattern: Star, Circle, Star, Circle, Star, ___?",
            options: ["SQUARE", "TRIANGLE", "CIRCLE"],
            correctIndex: 2, // CIRCLE
            method: "The pattern is simple: Star followed by Circle. Therefore, the next shape is a Circle."
        },
        {
            id: 6,
            question: "I have 4 corners, and all my 4 sides are exactly the same length. What shape am I?",
            options: ["RECTANGLE", "TRIANGLE", "SQUARE"],
            correctIndex: 2, // SQUARE
            method: "A Square has 4 equal sides and 4 corners."
        },
        {
            id: 7,
            question: "If you have 2 Triangles, how many total sides do you have?",
            options: ["6", "7", "8"],
            correctIndex: 0, // 6 (3+3)
            method: "Each Triangle has 3 sides. 3 + 3 = 6 total sides."
        },
        {
            id: 8,
            question: "Which shape is often used to draw a roof on a house?",
            options: ["SQUARE", "TRIANGLE", "RECTANGLE"],
            correctIndex: 1, // TRIANGLE
            method: "A Triangle is commonly used for the pointed top (roof) of a drawing of a house."
        },
        {
            id: 9,
            question: "If a shape has more corners than a Square (4) and looks pointy, what could it be?",
            options: ["CIRCLE", "STAR", "RECTANGLE"],
            correctIndex: 1, // STAR (10 corners/points)
            method: "The Star has 10 points/corners, which is more than a Square's 4."
        },
        {
            id: 10,
            question: "What is the total number of straight sides on one Rectangle and one Square?",
            options: ["6", "8", "9"],
            correctIndex: 1, // 8 (4+4)
            method: "Rectangle (4 sides) + Square (4 sides) = 8 total straight sides."
        },
        {
            id: 11,
            question: "The pattern is: Triangle, Square, Triangle, Square... What is the 6th shape?",
            options: ["TRIANGLE", "CIRCLE", "SQUARE"],
            correctIndex: 2, // SQUARE
            method: "The pattern repeats every two shapes. The 6th shape is the same as the 2nd shape, which is a Square."
        },
        {
            id: 12,
            question: "Which of these shapes has the fewest corners?",
            options: ["TRIANGLE", "SQUARE", "CIRCLE"],
            correctIndex: 2, // CIRCLE (0 corners)
            method: "The Circle has 0 corners, which is the fewest."
        },
        {
            id: 13,
            question: "You see two Rectangles. How many corners do they have in total?",
            options: ["6", "8", "12"],
            correctIndex: 1, // 8 (4+4)
            method: "Each Rectangle has 4 corners. 4 + 4 = 8 total corners."
        },
        {
            id: 14,
            question: "I am a closed shape made of straight lines, but I only have 3 sides. What am I?",
            options: ["SQUARE", "RECTANGLE", "TRIANGLE"],
            correctIndex: 2, // TRIANGLE
            method: "A Triangle is the only shape listed that has exactly 3 straight sides."
        },
        {
            id: 15,
            question: "If you remove the Star (10 points) from a set of shapes, which remaining shape has the most corners?",
            options: ["SQUARE", "RECTANGLE", "TRIANGLE"],
            correctIndex: 0, // SQUARE/RECTANGLE (Both 4)
            method: "Both the Square and Rectangle have 4 corners, which is more than the Triangle (3) and Circle (0). Both Square or Rectangle is an acceptable answer, but we'll choose Square."
        }
    ];

    let quizQuestions = []; // Array to hold the 5 selected questions
    let currentQuestionIndex = 0;
    let answeredCorrectly = false;
    const totalQuestions = 5; // The number of questions for this quiz session

    // Function to select 5 unique random questions from the bank
    function selectRandomQuestions() {
        const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
        quizQuestions = shuffled.slice(0, totalQuestions);
    }

    // --- Core Rendering Functions ---

    function renderQuestion() {
        const container = document.getElementById('question-card-container');
        const q = quizQuestions[currentQuestionIndex];
        
        // Create a new card element
        const newCard = document.createElement('div');
        // We need to use position:absolute again here to make the transition work correctly
        newCard.className = 'question-card animate-in';
        newCard.style.position = 'absolute'; // Added absolute positioning for the transition logic
        newCard.style.top = '0';
        newCard.style.left = '0';

        newCard.innerHTML = `
            <h3 class="text-center">Riddle ${currentQuestionIndex + 1} of ${totalQuestions}</h3>
            <p class="mb-6 text-center">${q.question}</p>
            
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                ${q.options.map((option, index) => `
                    <button class="mcq-option" data-index="${index}" onclick="selectAnswer(this, ${index})">
                        ${option}
                    </button>
                `).join('')}
            </div>
            
            <div id="feedback-box" class="text-left"></div>
        `;
        
        // If there's an existing card, we need to handle the swap carefully to maintain animation
        const oldCard = container.querySelector('.question-card');
        if (oldCard) {
            // Ensure the old card remains visible while it animates out
            oldCard.style.position = 'absolute'; 
            oldCard.style.top = '0';
            oldCard.style.left = '0';
            
            // Append the new card first (it starts off-screen)
            container.appendChild(newCard);

            // Start the slide-out animation for the old card
            oldCard.classList.remove('animate-in');
            oldCard.classList.add('animate-out');

            // After the animation, remove the old card
            setTimeout(() => {
                container.removeChild(oldCard);
                // Crucially, remove the position absolute from the new card so the container can resize properly
                newCard.style.position = '';
                newCard.style.top = '';
                newCard.style.left = '';
            }, 450);
        } else {
            // Initial render: just append the new card
            container.appendChild(newCard);
            // Remove positioning after initial render
            newCard.style.position = '';
            newCard.style.top = '';
            newCard.style.left = '';
        }


        // Reset navigation and state
        document.getElementById('next-btn').disabled = true;
        document.getElementById('next-btn').classList.remove('bg-green-600', 'hover:bg-green-700', 'shadow-green-600/50', 'bg-pink-500', 'hover:bg-pink-600', 'shadow-pink-500/50');
        document.getElementById('next-btn').classList.add('bg-gray-400', 'cursor-not-allowed');
        document.getElementById('next-btn').textContent = "Next Problem"; // Reset text
        answeredCorrectly = false;
    }
    
    function updateProgressBar() {
        const progress = (currentQuestionIndex / totalQuestions) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    // --- Interaction Handlers ---

    function selectAnswer(button, selectedIndex) {
        if (answeredCorrectly) return; // Prevent re-answering a solved question

        const q = quizQuestions[currentQuestionIndex];
        const optionsContainer = document.getElementById('options-container');
        const allButtons = optionsContainer.querySelectorAll('button');
        const feedbackBox = document.getElementById('feedback-box');

        // Disable all buttons immediately after selection
        allButtons.forEach(btn => btn.disabled = true);

        if (selectedIndex === q.correctIndex) {
            // Correct Answer Logic
            button.classList.add('correct');
            feedbackBox.style.display = 'block';
            feedbackBox.className = 'feedback-correct';
            feedbackBox.innerHTML = `
                ðŸŽ‰Correct! Great job. <br>The answer is: ${q.method}
            `;
            
            answeredCorrectly = true;
            
            // Enable Next/Finish button
            const nextBtn = document.getElementById('next-btn');
            nextBtn.disabled = false;
            nextBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
            nextBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'shadow-green-600/50');

            if (currentQuestionIndex === totalQuestions - 1) {
                nextBtn.textContent = "Finish Journey! ðŸ†";
            } else {
                nextBtn.textContent = "Next Problem âž¡ï¸";
            }
        } else {
            // Incorrect Answer Logic (FIXED to allow retry)
            button.classList.add('incorrect');
            feedbackBox.style.display = 'block';
            feedbackBox.className = 'feedback-incorrect';
            feedbackBox.textContent = `
                âŒ Whoops! Try again! Read the riddle carefully.
            `;

            // Re-enable ALL buttons after a short delay so the user can retry.
            setTimeout(() => {
                button.classList.remove('incorrect');
                feedbackBox.style.display = 'none';
                
                // Re-enable all buttons so the user can select a different option
                allButtons.forEach(btn => {
                    btn.disabled = false;
                });

            }, 1000);
        }
    }

    function nextQuestion() {
        if (!answeredCorrectly) return; // Should not happen if button is disabled correctly

        // 1. If we are on the last question, finish the level (transition to Level 7 prep)
        if (currentQuestionIndex === totalQuestions - 1) {
            finishLevel();
            return;
        }

        // 2. Move to the next index and update progress bar (visually before new card appears)
        currentQuestionIndex++;
        updateProgressBar();

        // 3. Render the new card (animation handled inside renderQuestion)
        renderQuestion();
    }

    function finishLevel() {
        updateProgressBar(); // Ensure progress bar is full
        
        // CRITICAL FIX: Save completion status to localStorage
        localStorage.setItem("C7_Level6", "completed");
        
        const container = document.getElementById('question-card-container');
        const finishBtn = document.getElementById('next-btn');

        // Animate final quiz card out
        const currentCard = document.querySelector('.question-card');
        if (currentCard) {
            currentCard.classList.remove('animate-in');
            currentCard.classList.add('animate-out');
        }

        // Show final success message and prepare for Level 7
        setTimeout(() => {
            // Remove the old quiz card
            if (currentCard && container.contains(currentCard)) {
                container.removeChild(currentCard);
            }
            
            // Show completion message for Level 7
            const finalCard = document.createElement('div');
            finalCard.className = 'question-card text-center py-10 bg-yellow-50 animate-in';
            finalCard.innerHTML = `
                <p class="text-5xl mb-4 text-yellow-500">âœ…</p>
                <h3 class="text-3xl font-extrabold text-yellow-700 mb-2">LEVEL 6 COMPLETE!</h3>
                <p class="text-xl text-gray-600">You mastered the shapes! Ready for the final Fun Challenge?</p>
            `;
            container.appendChild(finalCard);
            
            // Update button for Level 7 transition
            finishBtn.disabled = false;
            finishBtn.classList.remove('bg-gray-400', 'cursor-not-allowed', 'bg-green-600', 'hover:bg-green-700');
            finishBtn.classList.add('bg-pink-500', 'hover:bg-pink-600', 'shadow-pink-500/50');
            finishBtn.textContent = "Go Back to Adventure Map ðŸ—ºï¸";
            
            // Update onclick to navigate back to C7.html
            finishBtn.onclick = function() {
                // This will navigate back to C7.html where Level 7 should now be unlocked
                window.location.href = 'C7.html';
            };
        }, 450);
    }
    
    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        selectRandomQuestions();
        updateProgressBar();
        renderQuestion();
    });
</script>
</body>
</html>