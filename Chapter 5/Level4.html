<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Chapter 5 â€“ Level 4: Time Calculation</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #74b9ff 0%, #f0f9ff 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            margin-top: 50px;
            font-size: 36px;
            color: #004d7f;
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.9);
        }

        /* Digital Clock Box */
        #digitalClock {
            font-size: 60px;
            font-weight: 800;
            color: #e63946;
            background: #fff;
            padding: 20px 50px;
            border-radius: 20px;
            border: 5px solid #004d7f;
            margin: 30px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            user-select: none;
            letter-spacing: 2px;
        }

        /* The math problem section */
        #calculation-box {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        #question {
            font-size: 22px;
            color: #004d7f;
            font-weight: 700;
            margin-bottom: 10px;
        }

        #additionTime {
            font-size: 28px;
            color: #d35400; /* Burnt orange for emphasis */
            font-weight: 800;
        }

        #answers {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            max-width: 600px;
        }

        /* Your Button Style */
        .answer-btn {
            padding: 15px 30px;
            background: linear-gradient(145deg, #ffd60a, #ffb703);
            border-radius: 12px;
            border: 3px solid #fff;
            font-weight: 700;
            font-size: 20px;
            color: #a55a00;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 140px;
            text-align: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
        }

        .answer-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 8px 10px rgba(0, 0, 0, 0.2);
        }

        /* Disabled state for buttons */
        .answer-btn.disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Highlight styles */
        .answer-btn.correct {
            background: #06d6a0;
            color: white;
            border-color: #00b894;
        }
        
        .answer-btn.wrong {
            background: #e63946;
            color: white;
            border-color: #d62828;
        }

        #feedback {
            font-size: 24px;
            font-weight: 700;
            min-height: 40px;
            margin-bottom: 20px;
        }

        #nextBtn {
            padding: 12px 35px;
            background: linear-gradient(145deg, #06d6a0, #1b9aaa);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
            display: none;
            box-shadow: 0 4px 0 #0e7a8b;
        }

        #nextBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #0e7a8b;
        }

        /* --- Score Modal Styling --- */
        #score-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            color: #004d7f;
            max-width: 90%;
            border: 5px solid #ffde54;
            animation: fadeIn 0.3s;
        }

        .modal-content h2 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .modal-content p {
            font-size: 24px;
            margin-bottom: 25px;
        }

        .modal-button {
            padding: 15px 30px;
            background: linear-gradient(145deg, #06d6a0, #1b9aaa);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 20px;
            font-weight: 700;
            cursor: pointer;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>

<body>
    <h1>Level 4 â€“ Time Calculation</h1>

    <div id="digitalClock">00:00</div>

    <div id="calculation-box">
        <div id="question">Starting from this time, what time will it be in:</div>
        <div id="additionTime">+ X hours and Y minutes</div>
    </div>

    <div id="answers"></div>

    <div id="feedback"></div>

    <button id="nextBtn" onclick="nextQuestion()">Next Question</button>

    <!-- Score Modal -->
    <div id="score-modal">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <p id="modal-message"></p>
            <button class="modal-button" onclick="goToMenu()">Go to Main Menu</button>
        </div>
    </div>

    <script>
        const totalQuestions = 5;
        let current = 0;
        let score = 0;
        let correctAnswerText = "";

        /**
         * Generates a random start time (1-12 hours, 5-min intervals for minutes).
         */
        function getRandomTime() {
            const hour = Math.floor(Math.random() * 12) + 1; 
            const minute = Math.floor(Math.random() * 12) * 5; 
            return { hour, minute };
        }

        /**
         * Generates random duration to add.
         */
        function getRandomAddTime() {
            const addHour = Math.floor(Math.random() * 5) + 1; // 1 to 5 hours
            const addMinute = Math.floor(Math.random() * 11) * 5 + 5; // 5 to 55 mins
            return { addHour, addMinute };
        }

        /**
         * Formats time numbers into "HH:MM" string.
         */
        function formatTime(h, m) {
            const displayHour = (h === 0) ? 12 : h;
            return `${displayHour}:${m.toString().padStart(2, '0')}`;
        }

        /**
         * Calculates the new time.
         */
        function calculateNewTime(startHour, startMinute, addHour, addMinute) {
            // Treat 12 as 0 for calculation
            const h = (startHour === 12) ? 0 : startHour;

            let totalMinutes = startMinute + addMinute;
            let minuteCarry = Math.floor(totalMinutes / 60);
            const newMinutes = totalMinutes % 60;

            let totalHours = h + addHour + minuteCarry;
            let newHour = totalHours % 12;
            
            if (newHour === 0) newHour = 12;
            
            return { hour: newHour, minute: newMinutes };
        }

        /**
         * Generates incorrect options close to the answer.
         */
        function generateOptions(correct) {
            const correctText = formatTime(correct.hour, correct.minute);
            const options = [correctText];

            while (options.length < 4) {
                // Generate random times, sometimes close to the real answer for difficulty
                const h = Math.floor(Math.random() * 12) + 1;
                const m = Math.floor(Math.random() * 12) * 5;
                const opt = formatTime(h, m);
                
                if (!options.includes(opt)) {
                    options.push(opt);
                }
            }
            return options.sort(() => Math.random() - 0.5);
        }

        function loadQuestion() {
            document.getElementById("feedback").innerText = '';
            document.getElementById("nextBtn").style.display = 'none';

            const startTime = getRandomTime();
            const addTime = getRandomAddTime();
            
            // Update UI
            document.getElementById("digitalClock").innerText = formatTime(startTime.hour, startTime.minute);
            document.getElementById("additionTime").innerText = `+ ${addTime.addHour} hours and ${addTime.addMinute} minutes`;

            // Logic
            const correct = calculateNewTime(startTime.hour, startTime.minute, addTime.addHour, addTime.addMinute);
            correctAnswerText = formatTime(correct.hour, correct.minute);
            
            const options = generateOptions(correct);
            const answersDiv = document.getElementById("answers");
            answersDiv.innerHTML = '';

            options.forEach(opt => {
                const btn = document.createElement('div');
                btn.className = 'answer-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt, btn);
                answersDiv.appendChild(btn);
            });
        }

        function checkAnswer(selected, btnElement) {
            const feedbackEl = document.getElementById("feedback");
            
            // Disable all buttons
            const allButtons = document.querySelectorAll('.answer-btn');
            allButtons.forEach(btn => {
                btn.onclick = null;
                btn.classList.add('disabled');
            });

            if (selected === correctAnswerText) {
                feedbackEl.innerText = `âœ… Correct!`;
                feedbackEl.style.color = '#06d6a0';
                btnElement.classList.add('correct');
                btnElement.classList.remove('disabled');
                score++;
            } else {
                feedbackEl.innerText = `âŒ Wrong! Correct is ${correctAnswerText}`;
                feedbackEl.style.color = '#e63946';
                btnElement.classList.add('wrong');
                btnElement.classList.remove('disabled');
            }
            document.getElementById("nextBtn").style.display = 'inline-block';
        }

        function showScoreModal() {
            document.getElementById("modal-title").innerText = `ðŸŽ‰ Level 4 Completed!`;
            document.getElementById("modal-message").innerText = `Your final score is: ${score}/${totalQuestions}`;
            document.getElementById("score-modal").style.display = 'flex';
        }
        
        function goToMenu() {
            localStorage.setItem("C5_Level4", "completed");
            window.location.href = "C5.html"; 
        }

        function nextQuestion() {
            current++;
            if (current >= totalQuestions) {
                showScoreModal();
            } else {
                loadQuestion();
            }
        }

        window.onload = loadQuestion;
    </script>
</body>
</html>