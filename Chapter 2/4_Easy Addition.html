<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fruit Pop Level 4</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;800&display=swap');
body { font-family: 'Inter', sans-serif; background-color: #fef3c7; }
.game-card { border: 4px solid #f59e0b; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
.bubble { 
    background: radial-gradient(circle at 70% 30%, #fcd34d, #f59e0b);
    color: white;
    border-radius: 9999px;
    cursor: pointer;
    transition: transform 0.1s;
    box-shadow: 0 5px 0 0 #b45309;
}
.bubble:active {
    transform: scale(0.9);
    box-shadow: 0 2px 0 0 #b45309;
}
</style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen bg-yellow-50">

<div id="app" class="game-card w-full max-w-lg p-6 md:p-10 text-center rounded-2xl bg-white">
    <h1 class="text-3xl font-extrabold text-yellow-700 mb-4">ðŸŽˆ Fruit Pop Level 4</h1>
    <p class="text-gray-600 mb-6">Pop the bubble with the correct answer! (Sum â‰¤ 20)</p>

    <div class="bg-yellow-100 p-4 rounded-xl mb-8">
        <p class="text-xl font-semibold mb-2">Equation:</p>
        <p id="question-text" class="text-6xl font-black text-yellow-800">?</p>
    </div>

    <div id="choices-container" class="flex justify-around items-center h-32"></div>

    <div id="feedback" class="h-8 mt-6 text-lg font-bold"></div>
    <div class="mt-4 text-lg">Score: <span id="score">0</span> / 5</div>

    <button id="start-button" class="mt-6 px-8 py-3 bg-yellow-600 text-white font-bold rounded-xl bubble shadow-none">Start Popping</button>
</div>

<script>
const REQUIRED_SCORE = 5;
let score = 0;
let correctAnswer = 0;

const scoreEl = document.querySelector('#score');
const questionTextEl = document.getElementById('question-text');
const choicesContainer = document.getElementById('choices-container');
const feedbackEl = document.getElementById('feedback');
const startBtn = document.getElementById('start-button');

const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

function notifyLevelComplete() {
    window.parent.postMessage({ type: "levelResult", success: true }, "*");
}

function generateChoices(correctAnswer) {
    const choices = new Set([correctAnswer]);
    while (choices.size < 3) {
        let choice = getRandomInt(Math.max(1, correctAnswer - 3), Math.min(20, correctAnswer + 3));
        choices.add(choice);
    }
    return Array.from(choices).sort(() => Math.random() - 0.5);
}

function generateQuestion() {
    const num1 = getRandomInt(1, 10);
    let num2 = getRandomInt(1, 10);
    while (num1 + num2 > 20) num2 = getRandomInt(1, 10);
    correctAnswer = num1 + num2;

    questionTextEl.textContent = `${num1} + ${num2}`;
    feedbackEl.textContent = '';

    const choices = generateChoices(correctAnswer);
    renderChoices(choices);
}

function renderChoices(choices) {
    choicesContainer.innerHTML = '';
    choices.forEach(choice => {
        const btn = document.createElement('div');
        btn.textContent = choice;
        btn.className = 'bubble w-24 h-24 flex items-center justify-center text-3xl font-bold';
        btn.onclick = () => checkAnswer(choice, btn);
        choicesContainer.appendChild(btn);
    });
}

function checkAnswer(selectedAnswer, btnEl) {
    Array.from(choicesContainer.children).forEach(b => b.style.pointerEvents = 'none');

    if (selectedAnswer === correctAnswer) {
        score++;
        scoreEl.textContent = score;
        btnEl.style.backgroundColor = '#10b981';
        btnEl.style.transform = 'scale(1.5)';
        feedbackEl.textContent = 'POP! Correct!';
        feedbackEl.className = 'h-8 mt-6 text-lg font-bold text-green-600';

        if (score >= REQUIRED_SCORE) {
            feedbackEl.textContent = 'ðŸŽ‰ Level Completed!';
            notifyLevelComplete();
        } else {
            setTimeout(() => {
                generateQuestion();
            }, 1200);
        }
    } else {
        btnEl.style.backgroundColor = '#ef4444';
        feedbackEl.textContent = `Oops! Correct answer was ${correctAnswer}`;
        feedbackEl.className = 'h-8 mt-6 text-lg font-bold text-red-600';

        Array.from(choicesContainer.children).forEach(b => {
            if (parseInt(b.textContent) === correctAnswer) {
                b.style.backgroundColor = '#3b82f6';
                b.textContent = `${b.textContent} âœ…`;
            }
        });

        setTimeout(() => {
            generateQuestion();
        }, 2500);
    }
}

startBtn.onclick = () => {
    score = 0;
    scoreEl.textContent = score;
    startBtn.style.display = 'none';
    generateQuestion();
};
</script>
</body>
</html>
